{% extends 'layout.html' %} {% block head %}
<title>Pharmacy- Search Patient</title>
{% endblock %} {% block body %}
<div class="jumbotron">
    <h1 class="text-align-center">Get Patient Details</h1>
    <form method="POST" novalidate>
        {{ form.csrf_token }}
        <div class="form-group">
            <label for="formGroupExampleInput">{{ form.patient_id.label }}</label>
            {{ form.patient_id(class_="form-control")}}
            <!-- Error Messages -->
            {% for error in form.patient_id.errors %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <span>{{ error }}</span>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            {% endfor %}
        </div>
        {{ form.submit(class_="btn btn-primary", value="Search")}}
    <br>
    <!-- If Patient Found -->
    {% if patientData %}
    <h3 class="text-align-center">Patients Details</h3>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Age</th>
                <th scope="col">Address</th>
                <th scope="col">Date of Admission</th>


            </tr>
        </thead>
        <tbody>

            <tr>
                <th scope="row">{{ patientData.id }}</th>
                <td>{{ patientData.name }} </td>
                <td>{{ patientData.age }} </td>
                <td>{{ patientData.address }} </td>
                <td>{{ patientData.date_of_admission }} </td>

            </tr>

        </tbody>

        {% endif %}
    </table>
    {% if patientData %}
    <h3 class="text-align-center">Medicine Issued</h3>
    {% if MedJoinedTable[0] %}
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Serial No</th>
                <th scope="col">Medicines issued</th>
                <th scope="col">Qt of Medicine</th>
                <th scope="col">Rate</th>
                <th scope="col">Amount</th>

            </tr>
        </thead>
        <tbody>
            
            {% for row in MedJoinedTable %}
            <tr>
                <th scope="row">{{ loop.index }}</th>
                <td>{{ row[0].medicine_name }} </td>
                <td>{{ row[1].quantity }} </td>
                <td>{{ row[0].rate }} </td>
                <td>{{ row[1].quantity * row[0].rate }} </td>
            </tr>
            {% endfor %}
            
        </tbody>

    </table>
    {% else %}
        <div>
            No Medicines Issued till now...
        </div>
    {% endif %}
    <br><br>
    <input type="hidden" name="issueMedRequested" value="True">
    {{ form.submit(class_="btn btn-primary", value="Issue Medicines")}}
    {% endif %}
    </form>
    
</div>

{% endblock %}